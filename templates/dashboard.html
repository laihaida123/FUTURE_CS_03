{% extends "base.html" %}

{% block title %}Dashboard - Secure File Portal{% endblock %}

{% block content %}
<div class="dashboard">
    <div class="dashboard-header">
        <h2>File Management Dashboard</h2>
        <p>Upload and download encrypted files securely</p>
    </div>

    <div class="dashboard-content">
        <div class="upload-section">
            <h3>Upload File</h3>
            <form method="POST" action="{{ url_for('upload_file') }}" enctype="multipart/form-data" class="upload-form">
                <div class="file-input-wrapper">
                    <input 
                        type="file" 
                        id="file-input" 
                        name="file" 
                        required
                        accept="*/*"
                    >
                    <label for="file-input" class="file-label">
                        <span class="file-label-text">Choose a file...</span>
                        <span class="file-label-button">Browse</span>
                    </label>
                </div>
                <button type="submit" class="btn btn-primary">Upload & Encrypt</button>
            </form>
        </div>

        <div class="files-section">
            <h3>Available Files</h3>
            {% if files %}
            <div class="files-list">
                <table class="files-table">
                    <thead>
                        <tr>
                            <th>Filename</th>
                            <th>Size</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for file in files %}
                        <tr>
                            <td>{{ file.name }}</td>
                            <td>{{ "%.2f"|format(file.size / 1024) }} KB</td>
                            <td>
                                <a href="{{ url_for('download_file', filename=file.name) }}" class="btn btn-download">
                                    Download & Decrypt
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="no-files">
                <p>No files available. Upload a file to get started.</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Update file input label with selected filename
    document.getElementById('file-input').addEventListener('change', function(e) {
        const fileName = e.target.files[0]?.name || 'Choose a file...';
        document.querySelector('.file-label-text').textContent = fileName;
    });
</script>
{% endblock %}

